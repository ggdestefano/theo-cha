<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ChÃ¡ de bebÃª do ThÃ©o - Lista de Presentes</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background-color: #4a90e2;
    color: #fff;
  }
  h1, .event-info {
    text-align: center;
    color: #fff;
  }
  ul {
    list-style: none;
    padding: 0;
  }
  li {
    margin: 10px 0;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background: #fff;
    color: #333;
  }
  input[type="checkbox"] {
    margin-right: 10px;
  }
  .taken {
    text-decoration: line-through;
    color: #999;
    opacity: 0.6;
    background: #ffebee !important;
  }
  .taken input[type="checkbox"] {
    display: none;
  }
  .taken::before {
    content: "âœ… Limite atingido! ";
    font-weight: bold;
  }
  button {
    background: #fff;
    color: #4a90e2;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    width: 100%;
    margin: 5px 0;
  }
  button:hover {
    background: #e0e0e0;
  }
  #loading {
    text-align: center;
    color: #fff;
  }
  .form-group {
    margin: 20px 0;
  }
  input[type="text"], input[type="password"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background: #fff;
    color: #333;
  }
  #senha-zera {
    display: none;
    margin-top: 10px;
  }
  #senha-zera.active {
    display: block;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
  <h1>ðŸŽˆ ChÃ¡ de bebÃª do ThÃ©o ðŸŽˆ</h1>
  <div class="event-info">Data do evento: 09/11/2025 Ã s 15:00</div>

  <div class="form-group">
    <input type="text" id="nome" placeholder="Digite seu nome" required />
  </div>

  <p>Selecione um ou mais presentes abaixo e envie sua resposta.</p>

  <ul id="presentesList">
    <li id="loading">Carregando itens...</li>
  </ul>

  <p style="text-align: center; margin-top: 20px;">
    <button onclick="enviarFormulario()">Enviar Resposta</button>
    <button onclick="mostrarSenhaZerar()">Zerar Lista</button>
  </p>

  <div id="senha-zera">
    <input type="password" id="input-senha" placeholder="Digite a senha para zerar" />
    <button onclick="zerarLista()">Confirmar</button>
  </div>

<script>
  emailjs.init("Nt9goDnO2YFhX8RET");

  const URL_APPS_SCRIPT = 'https://script.google.com/macros/s/AKfycbxg9a7M1rI9eJRabn6LFZe8BqoELhf9K602Taz1B6UJw0fam3XAmJVhiTI5qRnO1t2nbw/exec';
  const SENHA_ZERAR = "thÃ©o2025";

  async function carregarContadores() {
    try {
      const response = await fetch(URL_APPS_SCRIPT, { method: 'GET' });
      if (!response.ok) throw new Error("Erro ao carregar dados");
      const data = await response.json();
      return data;
    } catch (error) {
      console.error("Erro ao carregar:", error);
      return {};
    }
  }

  async function atualizarContador(item) {
    try {
      const response = await fetch(URL_APPS_SCRIPT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ item, action: "increment" }),
      });
      if (!response.ok) throw new Error("Erro ao atualizar");
    } catch (error) {
      console.error("Erro ao atualizar contador:", error);
    }
  }

  function estaTomado(item, contadores) {
    const chave = item.toLowerCase().replace(/\s+/g, "_");
    const obj = contadores[chave];
    if (!obj) return false;
    return obj.contador >= obj.limite && obj.limite > 0;
  }

  function mostrarSenhaZerar() {
    document.getElementById("senha-zera").classList.add("active");
  }

  async function zerarLista() {
    const senha = document.getElementById("input-senha").value;
    if (senha === SENHA_ZERAR) {
      try {
        const response = await fetch(URL_APPS_SCRIPT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "reset" }),
        });
        if (!response.ok) throw new Error("Erro ao zerar lista");
        alert("Lista zerada!");
        document.getElementById("senha-zera").classList.remove("active");
        document.getElementById("input-senha").value = "";
        await renderizarLista();
      } catch (error) {
        alert("Erro ao zerar lista");
        console.error(error);
      }
    } else {
      alert("Senha errada!");
    }
  }

  async function renderizarLista() {
    const list = document.getElementById("presentesList");
    list.innerHTML = '<li id="loading">Carregando itens...</li>';

    const contadores = await carregarContadores();

    list.innerHTML = "";

    const presentes = [
      "Body Manga Longa (6-9)",
      "Body Manga Curta (6-9)",
      "Kit de lenÃ§os umedecidos",
      "Shampoo e sabonete baby",
      "Conjunto de roupinhas de banho",
      "Escova e pente",
      "Conjunto de potinhos para papinhas",
      "Babador",
      "Manta",
      "Cortador de unhas para bebÃª",
      "MacacÃ£o de dormir",
      "Urso de pelÃºcia",
      "Almofada de amamentaÃ§Ã£o",
      "Pomada para Assadura",
      "Cueiro",
      "Paninho de Boca",
      "Toalha de banho",
      "MijÃ£ozinho",
      "Sapatinhos",
      "Meias",
      "Aspirador Nasal",
      "Naninha",
      "Trocador",
      "Talco",
      "Saboneteira",
    ];

    presentes.forEach((item) => {
      const li = document.createElement("li");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.id = item.toLowerCase().replace(/\s+/g, "-");
      checkbox.name = "presentes";

      const label = document.createElement("label");
      label.htmlFor = checkbox.id;
      label.textContent = item;

      li.appendChild(checkbox);
      li.appendChild(label);

      if (estaTomado(item, contadores)) {
        li.classList.add("taken");
        checkbox.disabled = true;
      }

      list.appendChild(li);
    });
  }

  async function enviarFormulario() {
    const nome = document.getElementById("nome").value.trim();
    if (!nome) {
      alert("Digite seu nome!");
      return;
    }

    const selecionados = Array.from(
      document.querySelectorAll('input[name="presentes"]:checked')
    ).map((cb) => cb.nextElementSibling.textContent);

    if (selecionados.length === 0) {
      alert("Selecione um presente!");
      return;
    }

    const contadores = await carregarContadores();

    for (const item of selecionados) {
      if (estaTomado(item, contadores)) {
        alert(`${item} atingiu o limite!`);
        return;
      }
    }

    try {
      await emailjs.send("service_2jq56gm", "template_007ur9o", {
        nome: nome,
        presentes: selecionados.join(", "),
      });

      for (const item of selecionados) {
        await atualizarContador(item);
      }

      alert(`Obrigado, ${nome}!`);

      document.getElementById("nome").value = "";
      document
        .querySelectorAll('input[name="presentes"]:checked')
        .forEach((cb) => (cb.checked = false));

      await renderizarLista();
    } catch (error) {
      console.error(error);
      alert("Erro no envio. Verifique o console.");
    }
  }

  renderizarLista();
</script>
</body>
</html>

