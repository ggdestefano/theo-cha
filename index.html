<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChÃ¡ de BebÃª Theo - Lista de Presentes</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; color: #4a90e2; }
        ul { list-style: none; padding: 0; }
        li { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: #f9f9f9; }
        input[type="checkbox"] { margin-right: 10px; }
        .taken { text-decoration: line-through; color: #999; opacity: 0.6; background: #ffebee !important; }
        .taken input[type="checkbox"] { display: none; }
        .taken::before { content: "âœ… Tomado! "; font-weight: bold; }
        button { background: #4a90e2; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #357abd; }
        #loading { text-align: center; color: #666; }
        .form-group { margin: 20px 0; }
        input[type="text"] { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ChÃ¡ de BebÃª Theo ðŸŽ‰</h1>
    <p>Selecione um presente abaixo. Itens jÃ¡ escolhidos pelos convidados ficam riscados e indisponÃ­veis.</p>
    
    <ul id="presentesList">
        <li id="loading">Carregando itens...</li>
    </ul>

    <!-- FormulÃ¡rio original restaurado -->
    <div class="form-group">
        <input type="text" id="nome" placeholder="Digite seu nome" required>
        <button onclick="enviarFormulario()">Enviar Resposta</button>
    </div>

    <script>
        const presentes = [
            'Body Manga Longa (6-9)',
            'Body Manga Curta (6-9)',
            'Kit de lenÃ§os umedecidos',
            'Shampoo e sabonete baby',
            'Conjunto de roupinhas de banho',
            'Escova e pente',
            'Conjunto de potinhos para papinhas',
            'Babador',
            'Manta',
            'Cortador de unhas para bebÃª',
            'MacacÃ£o de dormir',
            'Urso de pelÃºcia',
            'Almofada de amamentaÃ§Ã£o',
            'Pomada para Assadura',
            'Cueiro',
            'Paninho de Boca',
            'Toalha de banho',
            'MijÃ£ozinho',
            'Sapatinhos',
            'Meias',
            'Aspirador Nasal',
            'Naninha',
            'Trocador',
            'Talco',
            'Saboneteira'
        ];

        async function carregarTakenItems() {
            try {
                const response = await fetch('/.netlify/functions/get-submissions');
                if (!response.ok) throw new Error('Erro na funÃ§Ã£o');
                const data = await response.json();
                return new Set(data.takenItems || []);
            } catch (error) {
                console.error('Erro ao carregar:', error);
                return new Set();
            }
        }

        async function renderizarLista() {
            const taken = await carregarTakenItems();
            const list = document.getElementById('presentesList');
            list.innerHTML = '';

            presentes.forEach(item => {
                const li = document.createElement('li');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = item.replace(/\s+/g, '-').toLowerCase();

                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = item;

                li.appendChild(checkbox);
                li.appendChild(label);

                if (taken.has(item)) {
                    li.classList.add('taken');
                } else {
                    checkbox.addEventListener('change', async () => {
                        if (checkbox.checked) {
                            const nome = document.getElementById('nome').value.trim();
                            if (!nome) {
                                alert('Por favor, digite seu nome antes de selecionar um presente!');
                                checkbox.checked = false;
                                return;
                            }
                            const success = await salvarSelecao(item, nome);
                            if (success) {
                                li.classList.add('taken');
                                checkbox.disabled = true;
                            } else {
                                checkbox.checked = false;
                            }
                        }
                    });
                }

                list.appendChild(li);
            });
        }

        async function salvarSelecao(item, nome) {
            try {
                const response = await fetch('/.netlify/functions/submit-presente', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ presente: item, nome: nome }) // Inclui o nome
                });
                if (response.ok) {
                    alert(`Obrigado, ${nome}! "${item}" foi reservado. Recarregue a pÃ¡gina pra ver atualizado pros outros.`);
                    return true;
                } else {
                    throw new Error('Falha ao salvar');
                }
            } catch (error) {
                console.error('Erro ao salvar:', error);
                alert('Erro ao reservar o presente. Tente novamente.');
                return false;
            }
        }

        // FunÃ§Ã£o para o formulÃ¡rio original
        async function enviarFormulario() {
            const nome = document.getElementById('nome').value.trim();
            if (!nome) {
                alert('Por favor, digite seu nome!');
                return;
            }
            // Aqui vocÃª pode enviar pro Formcarry original (ajuste a URL do FORM_ID)
            const FORM_ID = 'lKoCJSy5rO0'; // Substitua pelo seu FORM_ID real se diferente
            const API_KEY = 'k100jb17xHTsuj9aCpmfUS4MYOTJTGGX2o1EXDiG80VYnwVJBYjLGKD9tfOHIiuz';

            try {
                const response = await fetch(`https://formcarry.com/api/form/${FORM_ID}/submissions`, {
                    method: 'POST',
                    headers: { 'api_key': API_KEY, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ fields: [{ name: 'nome', value: nome }] })
                });
                if (response.ok) {
                    alert(`Obrigado, ${nome}! Sua resposta foi enviada.`);
                    document.getElementById('nome').value = ''; // Limpa o campo
                } else {
                    throw new Error('Falha ao enviar');
                }
            } catch (error) {
                console.error('Erro ao enviar:', error);
                alert('Erro ao enviar sua resposta. Tente novamente.');
            }
        }

        renderizarLista();
    </script>
</body>
</html>
