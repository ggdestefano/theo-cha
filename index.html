<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChÃ¡ de BebÃª Theo - Lista de Presentes</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; color: #4a90e2; }
        ul { list-style: none; padding: 0; }
        li { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: #f9f9f9; }
        input[type="checkbox"] { margin-right: 10px; }
        .taken { text-decoration: line-through; color: #999; opacity: 0.6; background: #ffebee !important; }
        .taken input[type="checkbox"] { display: none; } /* Esconde checkbox se jÃ¡ taken */
        .taken::before { content: "âœ… Tomado! "; font-weight: bold; }
        button { background: #4a90e2; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #357abd; }
        #loading { text-align: center; color: #666; }
    </style>
</head>
<body>
    <h1>ChÃ¡ de BebÃª Theo ðŸŽ‰</h1>
    <p>Selecione um presente abaixo. Itens jÃ¡ escolhidos pelos convidados ficam riscados e indisponÃ­veis.</p>
    
    <ul id="presentesList">
        <!-- Lista vai ser preenchida via JS -->
        <li id="loading">Carregando itens...</li>
    </ul>
    
    <p style="text-align: center; margin-top: 20px;">
        <button onclick="salvarSelecao('Body Manga Longa (6-9)')">Exemplo: Selecionar Body Manga Longa</button> <!-- Remove depois, sÃ³ pra teste -->
    </p>

    <script>
        // Lista de presentes (exatamente como vocÃª forneceu!)
        const presentes = [
            'Body Manga Longa (6-9)',
            'Body Manga Curta (6-9)',
            'Kit de lenÃ§os umedecidos',
            'Shampoo e sabonete baby',
            'Conjunto de roupinhas de banho',
            'Escova e pente',
            'Conjunto de potinhos para papinhas',
            'Babador',
            'Manta',
            'Cortador de unhas para bebÃª',
            'MacacÃ£o de dormir',
            'Urso de pelÃºcia',
            'Almofada de amamentaÃ§Ã£o',
            'Pomada para Assadura',
            'Cueiro',
            'Paninho de Boca',
            'Toalha de banho',
            'MijÃ£ozinho',
            'Sapatinhos',
            'Meias',
            'Aspirador Nasal',
            'Naninha',
            'Trocador',
            'Talco',
            'Saboneteira'
        ];

        // FunÃ§Ã£o pra carregar itens tomados
        async function carregarTakenItems() {
            try {
                const response = await fetch('/.netlify/functions/get-submissions');
                if (!response.ok) throw new Error('Erro na funÃ§Ã£o');
                const data = await response.json();
                return new Set(data.takenItems || []); // Set pra checagem rÃ¡pida
            } catch (error) {
                console.error('Erro ao carregar:', error);
                return new Set(); // Fallback vazio
            }
        }

        // Renderiza a lista
        async function renderizarLista() {
            const taken = await carregarTakenItems();
            const list = document.getElementById('presentesList');
            list.innerHTML = ''; // Limpa loading

            presentes.forEach(item => {
                const li = document.createElement('li');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = item.replace(/\s+/g, '-').toLowerCase(); // ID Ãºnico

                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = item;

                li.appendChild(checkbox);
                li.appendChild(label);

                // Se jÃ¡ taken, risca e esconde checkbox
                if (taken.has(item)) {
                    li.classList.add('taken');
                } else {
                    // Adiciona evento pra salvar quando selecionar
                    checkbox.addEventListener('change', () => {
                        if (checkbox.checked) {
                            salvarSelecao(item);
                            checkbox.disabled = true; // Impede mÃºltiplas seleÃ§Ãµes
                            li.classList.add('taken'); // Risca imediatamente
                        }
                    });
                }

                list.appendChild(li);
            });
        }

        // FunÃ§Ã£o pra "salvar" (envia pro Formcarry - ajuste a implementaÃ§Ã£o real)
        async function salvarSelecao(item) {
            // Para teste: Log e alerta
            console.log(`Selecionado: ${item}`);
            alert(`Obrigado! "${item}" foi reservado. Recarregue a pÃ¡gina pra ver atualizado pros outros.`);

            // TODO: Implementar envio real pro Formcarry
            // Exemplo: Descomente e ajuste a funÃ§Ã£o submit
            /*
            const response = await fetch('/.netlify/functions/submit-presente', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ presente: item })
            });
            if (response.ok) location.reload(); // Recarrega se sucesso
            */

            // Recarrega pra simular update (em prod, use polling ou WebSockets)
            setTimeout(() => location.reload(), 2000);
        }

        // Carrega na init
        renderizarLista();
    </script>
</body>
</html>
