<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChÃ¡ de bebÃª do ThÃ©o - Lista de Presentes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #4a90e2;
            color: #fff;
        }
        h1 {
            text-align: center;
            color: #fff;
            font-size: 2em;
        }
        .event-info {
            text-align: center;
            color: #fff;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fff;
            color: #333;
        }
        input[type="checkbox"] {
            margin-right: 10px;
        }
        .taken {
            text-decoration: line-through;
            color: #999;
            opacity: 0.6;
            background: #ffebee !important;
        }
        .taken input[type="checkbox"] {
            display: none;
        }
        .taken::before {
            content: "âœ… Limite atingido! ";
            font-weight: bold;
        }
        button {
            background: #fff;
            color: #4a90e2;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin: 5px 0;
        }
        button:hover {
            background: #e0e0e0;
        }
        #loading {
            text-align: center;
            color: #fff;
        }
        .form-group {
            margin: 20px 0;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fff;
            color: #333;
        }
        #senha-zerar {
            display: none;
            margin-top: 10px;
        }
        #senha-zerar.active {
            display: block;
        }
    </style>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
    <h1>ðŸŽˆ ChÃ¡ de bebÃª do ThÃ©o ðŸŽˆ</h1>
    <div class="event-info">Data do evento: 09/11/2025 Ã s 15:00</div>

    <div class="form-group">
        <input type="text" id="nome" placeholder="Digite seu nome" required>
    </div>

    <p style="color: #fff;">Selecione um ou mais presentes abaixo e envie sua resposta.</p>
    
    <ul id="presentesList">
        <li id="loading">Carregando itens...</li>
    </ul>

    <p style="text-align: center; margin-top: 20px;">
        <button onclick="enviarFormulario()">Enviar Resposta</button>
        <button id="btn-zerar" onclick="mostrarSenhaZerar()">Zerar Lista</button>
    </p>
    <div id="senha-zerar">
        <input type="password" id="input-senha" placeholder="Digite a senha para zerar">
        <button onclick="zerarLista()">Confirmar</button>
    </div>

    <script>
        (function() {
            emailjs.init({
                publicKey: "Nt9goDnO2YFhX8RET" // Substitua pela sua Public Key
            });
            console.log("EmailJS inicializado com Public Key.");
        })();

        const presentes = [
            'Body Manga Longa (6-9)',
            'Body Manga Curta (6-9)',
            'Kit de lenÃ§os umedecidos',
            'Shampoo e sabonete baby',
            'Conjunto de roupinhas de banho',
            'Escova e pente',
            'Conjunto de potinhos para papinhas',
            'Babador',
            'Manta',
            'Cortador de unhas para bebÃª',
            'MacacÃ£o de dormir',
            'Urso de pelÃºcia',
            'Almofada de amamentaÃ§Ã£o',
            'Pomada para Assadura',
            'Cueiro',
            'Paninho de Boca',
            'Toalha de banho',
            'MijÃ£ozinho',
            'Sapatinhos',
            'Meias',
            'Aspirador Nasal',
            'Naninha',
            'Trocador',
            'Talco',
            'Saboneteira'
        ];

        const limitesPorItem = [3, 3, 1, 5, 2, 1, 4, 5, 2, 1, 3, 1, 2, 5, 3, 5, 2, 1, 4, 5, 1, 2, 1, 5, 3];
        const SENHA_ZERAR = "theo123"; // Defina uma senha aqui (ex.: "thÃ©o2025"). Mude pra algo seguro!

        function carregarContadores() {
            const contadores = {};
            presentes.forEach((item, index) => {
                const chave = `contador_${item.replace(/\s+/g, '_').toLowerCase()}`;
                contadores[chave] = parseInt(localStorage.getItem(chave) || '0');
            });
            return contadores;
        }

        function atualizarContador(item) {
            const chave = `contador_${item.replace(/\s+/g, '_').toLowerCase()}`;
            const atual = parseInt(localStorage.getItem(chave) || '0');
            const novoValor = atual + 1;
            localStorage.setItem(chave, novoValor.toString());
            console.log(`Atualizado ${chave} para ${novoValor}`);
        }

        function estaTomado(item, index) {
            const chave = `contador_${item.replace(/\s+/g, '_').toLowerCase()}`;
            const atual = parseInt(localStorage.getItem(chave) || '0');
            console.log(`Verificando ${item}: atual=${atual}, limite=${limitesPorItem[index]}`);
            return atual >= limitesPorItem[index];
        }

        function mostrarSenhaZerar() {
            document.getElementById('senha-zerar').classList.add('active');
        }

        function zerarLista() {
            const senha = document.getElementById('input-senha').value;
            if (senha === SENHA_ZERAR) {
                presentes.forEach(item => {
                    const chave = `contador_${item.replace(/\s+/g, '_').toLowerCase()}`;
                    localStorage.removeItem(chave);
                    console.log(`Zerado ${chave}`);
                });
                renderizarLista();
                alert("Lista zerada com sucesso! Os itens estÃ£o disponÃ­veis novamente.");
                document.getElementById('senha-zerar').classList.remove('active');
                document.getElementById('input-senha').value = '';
            } else {
                alert("Senha incorreta! Tente novamente.");
            }
        }

        function renderizarLista() {
            const list = document.getElementById('presentesList');
            list.innerHTML = '';

            presentes.forEach((item, index) => {
                const li = document.createElement('li');
                const checkbox = document.createElement('input');
                checkbox.type='checkbox';
                checkbox.id = item.replace(/\s+/g, '-').toLowerCase();
                checkbox.name = 'presentes';

                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = item;

                li.appendChild(checkbox);
                li.appendChild(label);

                if (estaTomado(item, index)) {
                    li.classList.add('taken');
                    checkbox.disabled = true;
                }

                list.appendChild(li);
            });
        }

        async function enviarFormulario() {
            const nome = document.getElementById('nome').value.trim();
            if (!nome) {
                alert('Por favor, digite seu nome!');
                return;
            }

            const selecionados = Array.from(document.querySelectorAll('input[name="presentes"]:checked'))
                .map(cb => {
                    const item = cb.nextElementSibling.textContent;
                    const index = presentes.indexOf(item);
                    return { item, index };
                });

            if (selecionados.length === 0) {
                alert('Por favor, selecione pelo menos um presente!');
                return;
            }

            for (let sel of selecionados) {
                if (estaTomado(sel.item, sel.index)) {
                    alert(`O item "${sel.item}" jÃ¡ atingiu o limite de seleÃ§Ãµes!`);
                    return;
                }
            }

            try {
                console.log('Tentando enviar:', { nome, presentes: selecionados.map(s => s.item).join(', ') });
                const response = await emailjs.send("service_2jq56gm", "template_007ur9o", {
                    nome: nome,
                    presentes: selecionados.map(s => s.item).join(', ')
                });
                console.log('Resposta do servidor:', response);

                selecionados.forEach(sel => atualizarContador(sel.item));
                renderizarLista();

                alert(`Obrigado, ${nome}! Seus presentes foram enviados.`);
                document.getElementById('nome').value = '';
                document.querySelectorAll('input[name="presentes"]:checked').forEach(cb => cb.checked = false);
            } catch (error) {
                console.error('Erro detalhado:', error);
                if (error.status) {
                    console.error('Status:', error.status, 'Texto:', error.text || 'Sem texto');
                    alert(`Erro de conexÃ£o: Status ${error.status}. Verifique o console ou tente novamente.`);
                } else {
                    alert('Erro desconhecido. Verifique o console para mais detalhes.');
                }
            }
        }

        renderizarLista();
    </script>
</body>
</html>
