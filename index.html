<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChÃ¡ de BebÃª Theo - Lista de Presentes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #4a90e2;
            color: #fff;
        }
        h1 {
            text-align: center;
            color: #fff;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fff;
            color: #333;
        }
        input[type="checkbox"] {
            margin-right: 10px;
        }
        .taken {
            text-decoration: line-through;
            color: #999;
            opacity: 0.6;
            background: #ffebee !important;
        }
        .taken input[type="checkbox"] {
            display: none;
        }
        .taken::before {
            content: "âœ… Tomado! ";
            font-weight: bold;
        }
        .limite-info {
            font-size: 0.8em;
            color: #666;
        }
        button {
            background: #fff;
            color: #4a90e2;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background: #e0e0e0;
        }
        #loading {
            text-align: center;
            color: #fff;
        }
        .form-group {
            margin: 20px 0;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fff;
            color: #333;
        }
    </style>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        emailjs.init("Nt9goDnO2YFhX8RET"); // Substitua pela sua Public Key
    </script>
</head>
<body>
    <h1>ChÃ¡ de BebÃª Theo ðŸŽ‰</h1>

    <div class="form-group">
        <input type="text" id="nome" placeholder="Digite seu nome" required>
    </div>

    <p style="color: #fff;">Selecione um ou mais presentes abaixo e envie sua resposta. Alguns itens tÃªm limites de seleÃ§Ãµes.</p>
    
    <ul id="presentesList">
        <li id="loading">Carregando itens...</li>
    </ul>

    <p style="text-align: center; margin-top: 20px;">
        <button onclick="enviarFormulario()">Enviar Resposta</button>
    </p>

    <script>
        const presentes = [
            'Body Manga Longa (6-9)',
            'Body Manga Curta (6-9)',
            'Kit de lenÃ§os umedecidos',
            'Shampoo e sabonete baby',
            'Conjunto de roupinhas de banho',
            'Escova e pente',
            'Conjunto de potinhos para papinhas',
            'Babador',
            'Manta',
            'Cortador de unhas para bebÃª',
            'MacacÃ£o de dormir',
            'Urso de pelÃºcia',
            'Almofada de amamentaÃ§Ã£o',
            'Pomada para Assadura',
            'Cueiro',
            'Paninho de Boca',
            'Toalha de banho',
            'MijÃ£ozinho',
            'Sapatinhos',
            'Meias',
            'Aspirador Nasal',
            'Naninha',
            'Trocador',
            'Talco',
            'Saboneteira'
        ];

        // Limites por item (ajuste conforme necessÃ¡rio: Ã­ndice corresponde ao presente)
        const limitesPorItem = [
            3,  // Body Manga Longa (6-9) - atÃ© 3
            3,  // Body Manga Curta (6-9) - atÃ© 3
            5,  // Kit de lenÃ§os umedecidos - sÃ³ 1
            3,  // Shampoo e sabonete baby - atÃ© 5
            4,  // Conjunto de roupinhas de banho - atÃ© 2
            2,  // Escova e pente - sÃ³ 1
            4,  // Conjunto de potinhos para papinhas - atÃ© 4
            5,  // Babador - atÃ© 5
            2,  // Manta - atÃ© 2
            1,  // Cortador de unhas para bebÃª - sÃ³ 1
            3,  // MacacÃ£o de dormir - atÃ© 3
            5,  // Urso de pelÃºcia - sÃ³ 1 (exclusivo)
            2,  // Almofada de amamentaÃ§Ã£o - atÃ© 2
            3,  // Pomada para Assadura - atÃ© 5
            2,  // Cueiro - atÃ© 3
            5,  // Paninho de Boca - atÃ© 5
            2,  // Toalha de banho - atÃ© 2
            1,  // MijÃ£ozinho - sÃ³ 1
            4,  // Sapatinhos - atÃ© 4
            8,  // Meias - atÃ© 5
            1,  // Aspirador Nasal - sÃ³ 1
            2,  // Naninha - atÃ© 2
            1,  // Trocador - sÃ³ 1
            5,  // Talco - atÃ© 5
            3   // Saboneteira - atÃ© 3
        ];

        // Carrega contadores do localStorage
        function carregarContadores() {
            const contadores = {};
            presentes.forEach((item, index) => {
                const chave = `contador_${item.replace(/\s+/g, '_').toLowerCase()}`;
                contadores[chave] = parseInt(localStorage.getItem(chave) || '0');
            });
            return contadores;
        }

        // Atualiza contador no localStorage
        function atualizarContador(item, quantidade = 1) {
            const chave = `contador_${item.replace(/\s+/g, '_').toLowerCase()}`;
            const atual = parseInt(localStorage.getItem(chave) || '0');
            localStorage.setItem(chave, (atual + quantidade).toString());
        }

        // Verifica se item estÃ¡ tomado (atingiu limite)
        function estaTomado(item, index) {
            const chave = `contador_${item.replace(/\s+/g, '_').toLowerCase()}`;
            const atual = parseInt(localStorage.getItem(chave) || '0');
            return atual >= limitesPorItem[index];
        }

        async function renderizarLista() {
            const list = document.getElementById('presentesList');
            list.innerHTML = '';

            presentes.forEach((item, index) => {
                const li = document.createElement('li');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = item.replace(/\s+/g, '-').toLowerCase();
                checkbox.name = 'presentes';

                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = item;

                // Info do limite
                const limiteInfo = document.createElement('div');
                limiteInfo.className = 'limite-info';
                limiteInfo.textContent = `(Limite: ${limitesPorItem[index]})`;

                li.appendChild(checkbox);
                li.appendChild(label);
                li.appendChild(limiteInfo);

                if (estaTomado(item, index)) {
                    li.classList.add('taken');
                    checkbox.disabled = true;
                }

                list.appendChild(li);
            });
        }

        async function enviarFormulario() {
            const nome = document.getElementById('nome').value.trim();
            if (!nome) {
                alert('Por favor, digite seu nome!');
                return;
            }

            const selecionados = Array.from(document.querySelectorAll('input[name="presentes"]:checked'))
                .map(cb => {
                    const item = cb.nextElementSibling.textContent;
                    const index = presentes.indexOf(item);
                    return { item, index };
                });

            if (selecionados.length === 0) {
                alert('Por favor, selecione pelo menos um presente!');
                return;
            }

            // Verifica limites antes de enviar
            for (let sel of selecionados) {
                if (estaTomado(sel.item, sel.index)) {
                    alert(`O item "${sel.item}" jÃ¡ atingiu o limite de seleÃ§Ãµes!`);
                    return;
                }
            }

            try {
                await emailjs.send("service_2jq56gm", "template_007ur9o", {
                    nome: nome,
                    presentes: selecionados.map(s => s.item).join(', ')
                });
                alert(`Obrigado, ${nome}! Seus presentes foram enviados.`);
                
                // Atualiza contadores e recarrega lista
                selecionados.forEach(sel => atualizarContador(sel.item));
                renderizarLista(); // Atualiza em tempo real
                
                document.getElementById('nome').value = '';
                document.querySelectorAll('input[name="presentes"]:checked').forEach(cb => cb.checked = false);
            } catch (error) {
                console.error('Erro ao enviar:', error);
                alert('Erro no envio. Verifique o console ou sua conexÃ£o.');
            }
        }

        renderizarLista();
    </script>
</body>
</html>
